-- Taskdesk seed data
-- Run after migrations in Supabase SQL editor

begin;

-- 1 org
insert into public.organizations (id, name, created_at)
values (
  '10000000-0000-0000-0000-000000000001',
  'Taskdesk Demo Org',
  '2026-01-01T09:00:00Z'
)
on conflict (id) do nothing;

-- Auth users (required parent rows for public.users)
insert into auth.users (
  instance_id,
  id,
  aud,
  role,
  email,
  encrypted_password,
  email_confirmed_at,
  raw_app_meta_data,
  raw_user_meta_data,
  created_at,
  updated_at
)
values
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000001',
    'authenticated',
    'authenticated',
    'ava.founder@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Ava Founder"}'::jsonb,
    now(),
    now()
  ),
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000002',
    'authenticated',
    'authenticated',
    'mason.manager@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Mason Manager"}'::jsonb,
    now(),
    now()
  ),
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000003',
    'authenticated',
    'authenticated',
    'nora.manager@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Nora Manager"}'::jsonb,
    now(),
    now()
  ),
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000004',
    'authenticated',
    'authenticated',
    'liam.member@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Liam Member"}'::jsonb,
    now(),
    now()
  ),
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000005',
    'authenticated',
    'authenticated',
    'zoe.member@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Zoe Member"}'::jsonb,
    now(),
    now()
  ),
  (
    '00000000-0000-0000-0000-000000000000',
    '20000000-0000-0000-0000-000000000006',
    'authenticated',
    'authenticated',
    'owen.member@taskdesk.dev',
    crypt('password123', gen_salt('bf')),
    now(),
    '{"provider":"email","providers":["email"]}'::jsonb,
    '{"name":"Owen Member"}'::jsonb,
    now(),
    now()
  )
on conflict (id) do nothing;

-- 1 founder, 2 managers, 3 members
insert into public.users (id, org_id, name, email, role, expo_push_token, created_at)
values
  (
    '20000000-0000-0000-0000-000000000001',
    '10000000-0000-0000-0000-000000000001',
    'Ava Founder',
    'ava.founder@taskdesk.dev',
    'founder',
    'ExponentPushToken[avaFounderToken]',
    '2026-01-01T10:00:00Z'
  ),
  (
    '20000000-0000-0000-0000-000000000002',
    '10000000-0000-0000-0000-000000000001',
    'Mason Manager',
    'mason.manager@taskdesk.dev',
    'manager',
    'ExponentPushToken[masonManagerToken]',
    '2026-01-01T10:05:00Z'
  ),
  (
    '20000000-0000-0000-0000-000000000003',
    '10000000-0000-0000-0000-000000000001',
    'Nora Manager',
    'nora.manager@taskdesk.dev',
    'manager',
    'ExponentPushToken[noraManagerToken]',
    '2026-01-01T10:10:00Z'
  ),
  (
    '20000000-0000-0000-0000-000000000004',
    '10000000-0000-0000-0000-000000000001',
    'Liam Member',
    'liam.member@taskdesk.dev',
    'member',
    'ExponentPushToken[liamMemberToken]',
    '2026-01-01T10:20:00Z'
  ),
  (
    '20000000-0000-0000-0000-000000000005',
    '10000000-0000-0000-0000-000000000001',
    'Zoe Member',
    'zoe.member@taskdesk.dev',
    'member',
    'ExponentPushToken[zoeMemberToken]',
    '2026-01-01T10:25:00Z'
  ),
  (
    '20000000-0000-0000-0000-000000000006',
    '10000000-0000-0000-0000-000000000001',
    'Owen Member',
    'owen.member@taskdesk.dev',
    'member',
    'ExponentPushToken[owenMemberToken]',
    '2026-01-01T10:30:00Z'
  )
on conflict (id) do nothing;

-- 3 clients
insert into public.clients (id, org_id, name, created_at)
values
  ('30000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Acme Ventures', '2026-01-02T09:00:00Z'),
  ('30000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 'Northstar Labs', '2026-01-02T09:10:00Z'),
  ('30000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Blue Harbor Health', '2026-01-02T09:20:00Z')
on conflict (id) do nothing;

-- 8 campaigns with mixed risk statuses
insert into public.campaigns (
  id,
  org_id,
  client_id,
  name,
  launch_date,
  risk_status,
  created_by,
  created_at,
  updated_at
)
values
  ('40000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'Acme Q1 Product Launch', '2026-03-01T16:00:00Z', 'normal', '20000000-0000-0000-0000-000000000001', '2026-01-03T08:00:00Z', '2026-01-03T08:00:00Z'),
  ('40000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'Acme Retention Sprint', '2026-03-15T16:00:00Z', 'at_risk', '20000000-0000-0000-0000-000000000002', '2026-01-03T08:15:00Z', '2026-01-03T08:15:00Z'),
  ('40000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', 'Acme Paid Social Expansion', '2026-04-01T16:00:00Z', 'high_risk', '20000000-0000-0000-0000-000000000003', '2026-01-03T08:30:00Z', '2026-01-03T08:30:00Z'),
  ('40000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002', 'Northstar Spring Launch', '2026-03-10T16:00:00Z', 'normal', '20000000-0000-0000-0000-000000000001', '2026-01-04T08:00:00Z', '2026-01-04T08:00:00Z'),
  ('40000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002', 'Northstar Webinar Funnel', '2026-03-20T16:00:00Z', 'at_risk', '20000000-0000-0000-0000-000000000002', '2026-01-04T08:10:00Z', '2026-01-04T08:10:00Z'),
  ('40000000-0000-0000-0000-000000000006', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000003', 'Blue Harbor Brand Refresh', '2026-04-10T16:00:00Z', 'normal', '20000000-0000-0000-0000-000000000003', '2026-01-05T08:00:00Z', '2026-01-05T08:00:00Z'),
  ('40000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000003', 'Blue Harbor Patient Education', '2026-04-20T16:00:00Z', 'high_risk', '20000000-0000-0000-0000-000000000001', '2026-01-05T08:15:00Z', '2026-01-05T08:15:00Z'),
  ('40000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000003', 'Blue Harbor Email Reactivation', '2026-05-01T16:00:00Z', 'normal', '20000000-0000-0000-0000-000000000002', '2026-01-05T08:30:00Z', '2026-01-05T08:30:00Z')
on conflict (id) do nothing;

-- 25 tasks in mixed states and risk levels
insert into public.tasks (
  id,
  campaign_id,
  org_id,
  title,
  owner_id,
  due_date,
  dependency_id,
  status,
  risk_flag,
  assigned_at,
  created_at,
  updated_at
)
values
  ('50000000-0000-0000-0000-000000000001', '40000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Finalize launch brief', '20000000-0000-0000-0000-000000000002', '2026-02-10T17:00:00Z', null, 'completed', null, '2026-01-06T09:00:00Z', '2026-01-06T08:00:00Z', '2026-01-20T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000002', '40000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Approve creative concepts', '20000000-0000-0000-0000-000000000001', '2026-02-12T17:00:00Z', '50000000-0000-0000-0000-000000000001', 'in_progress', null, '2026-01-06T09:15:00Z', '2026-01-06T08:30:00Z', '2026-01-24T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000003', '40000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Publish launch landing page', '20000000-0000-0000-0000-000000000004', '2026-02-20T17:00:00Z', '50000000-0000-0000-0000-000000000002', 'not_started', null, '2026-01-07T09:00:00Z', '2026-01-07T08:00:00Z', '2026-01-07T08:00:00Z'),
  ('50000000-0000-0000-0000-000000000004', '40000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 'Build retention audience segments', '20000000-0000-0000-0000-000000000005', '2026-02-18T17:00:00Z', null, 'completed', null, '2026-01-07T09:30:00Z', '2026-01-07T08:20:00Z', '2026-01-23T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000005', '40000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 'Draft win-back email sequence', '20000000-0000-0000-0000-000000000006', '2026-02-21T17:00:00Z', '50000000-0000-0000-0000-000000000004', 'blocked', 'soft_risk', '2026-01-08T09:00:00Z', '2026-01-08T08:00:00Z', '2026-01-26T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000006', '40000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000001', 'QA automation triggers', '20000000-0000-0000-0000-000000000002', '2026-02-24T17:00:00Z', '50000000-0000-0000-0000-000000000005', 'not_started', 'soft_risk', '2026-01-08T09:15:00Z', '2026-01-08T08:30:00Z', '2026-01-08T08:30:00Z'),
  ('50000000-0000-0000-0000-000000000007', '40000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Rebuild paid social budget model', '20000000-0000-0000-0000-000000000003', '2026-02-14T17:00:00Z', null, 'in_progress', 'hard_risk', '2026-01-09T09:00:00Z', '2026-01-09T08:00:00Z', '2026-01-25T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000008', '40000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Secure creative approvals', '20000000-0000-0000-0000-000000000001', '2026-02-15T17:00:00Z', null, 'blocked', 'hard_risk', '2026-01-09T09:20:00Z', '2026-01-09T08:20:00Z', '2026-01-27T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000009', '40000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Launch prospecting ads', '20000000-0000-0000-0000-000000000004', '2026-02-28T17:00:00Z', '50000000-0000-0000-0000-000000000008', 'not_started', 'hard_risk', '2026-01-09T09:45:00Z', '2026-01-09T08:45:00Z', '2026-01-09T08:45:00Z'),
  ('50000000-0000-0000-0000-000000000010', '40000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', 'Kickoff launch workshop', '20000000-0000-0000-0000-000000000002', '2026-02-09T17:00:00Z', null, 'completed', null, '2026-01-10T09:00:00Z', '2026-01-10T08:00:00Z', '2026-01-18T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000011', '40000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', 'Review messaging pillars', '20000000-0000-0000-0000-000000000005', '2026-02-13T17:00:00Z', '50000000-0000-0000-0000-000000000010', 'in_progress', null, '2026-01-10T09:15:00Z', '2026-01-10T08:20:00Z', '2026-01-21T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000012', '40000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000001', 'Publish webinar signup page', '20000000-0000-0000-0000-000000000006', '2026-02-18T17:00:00Z', '50000000-0000-0000-0000-000000000011', 'not_started', null, '2026-01-10T09:30:00Z', '2026-01-10T08:30:00Z', '2026-01-10T08:30:00Z'),
  ('50000000-0000-0000-0000-000000000013', '40000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'Design webinar invite emails', '20000000-0000-0000-0000-000000000004', '2026-02-16T17:00:00Z', null, 'in_progress', 'soft_risk', '2026-01-11T09:00:00Z', '2026-01-11T08:00:00Z', '2026-01-22T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000014', '40000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'Confirm speaker lineup', '20000000-0000-0000-0000-000000000001', '2026-02-17T17:00:00Z', null, 'completed', null, '2026-01-11T09:20:00Z', '2026-01-11T08:20:00Z', '2026-01-19T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000015', '40000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'Build registration flow QA list', '20000000-0000-0000-0000-000000000005', '2026-02-23T17:00:00Z', '50000000-0000-0000-0000-000000000014', 'not_started', 'soft_risk', '2026-01-11T09:40:00Z', '2026-01-11T08:40:00Z', '2026-01-11T08:40:00Z'),
  ('50000000-0000-0000-0000-000000000016', '40000000-0000-0000-0000-000000000006', '10000000-0000-0000-0000-000000000001', 'Audit brand assets', '20000000-0000-0000-0000-000000000003', '2026-02-12T17:00:00Z', null, 'completed', null, '2026-01-12T09:00:00Z', '2026-01-12T08:00:00Z', '2026-01-20T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000017', '40000000-0000-0000-0000-000000000006', '10000000-0000-0000-0000-000000000001', 'Draft refreshed style guide', '20000000-0000-0000-0000-000000000004', '2026-02-19T17:00:00Z', '50000000-0000-0000-0000-000000000016', 'in_progress', null, '2026-01-12T09:15:00Z', '2026-01-12T08:20:00Z', '2026-01-24T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000018', '40000000-0000-0000-0000-000000000006', '10000000-0000-0000-0000-000000000001', 'Sign off visual system', '20000000-0000-0000-0000-000000000001', '2026-02-25T17:00:00Z', '50000000-0000-0000-0000-000000000017', 'not_started', null, '2026-01-12T09:35:00Z', '2026-01-12T08:35:00Z', '2026-01-12T08:35:00Z'),
  ('50000000-0000-0000-0000-000000000019', '40000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000001', 'Map patient education journey', '20000000-0000-0000-0000-000000000002', '2026-02-14T17:00:00Z', null, 'completed', 'soft_risk', '2026-01-13T09:00:00Z', '2026-01-13T08:00:00Z', '2026-01-21T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000020', '40000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000001', 'Create provider interview scripts', '20000000-0000-0000-0000-000000000006', '2026-02-22T17:00:00Z', '50000000-0000-0000-0000-000000000019', 'in_progress', 'hard_risk', '2026-01-13T09:20:00Z', '2026-01-13T08:20:00Z', '2026-01-26T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000021', '40000000-0000-0000-0000-000000000007', '10000000-0000-0000-0000-000000000001', 'Legal review for education copy', '20000000-0000-0000-0000-000000000003', '2026-02-27T17:00:00Z', '50000000-0000-0000-0000-000000000020', 'not_started', 'hard_risk', '2026-01-13T09:35:00Z', '2026-01-13T08:35:00Z', '2026-01-13T08:35:00Z'),
  ('50000000-0000-0000-0000-000000000022', '40000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', 'Segment dormant users', '20000000-0000-0000-0000-000000000005', '2026-02-11T17:00:00Z', null, 'completed', null, '2026-01-14T09:00:00Z', '2026-01-14T08:00:00Z', '2026-01-18T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000023', '40000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', 'Write reactivation copy', '20000000-0000-0000-0000-000000000004', '2026-02-17T17:00:00Z', '50000000-0000-0000-0000-000000000022', 'in_progress', null, '2026-01-14T09:15:00Z', '2026-01-14T08:20:00Z', '2026-01-23T12:00:00Z'),
  ('50000000-0000-0000-0000-000000000024', '40000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', 'Prepare send-time experiment', '20000000-0000-0000-0000-000000000002', '2026-02-19T17:00:00Z', '50000000-0000-0000-0000-000000000023', 'not_started', null, '2026-01-14T09:30:00Z', '2026-01-14T08:30:00Z', '2026-01-14T08:30:00Z'),
  ('50000000-0000-0000-0000-000000000025', '40000000-0000-0000-0000-000000000008', '10000000-0000-0000-0000-000000000001', 'Post-launch performance readout', '20000000-0000-0000-0000-000000000001', '2026-03-05T17:00:00Z', '50000000-0000-0000-0000-000000000024', 'completed', null, '2026-01-14T09:45:00Z', '2026-01-14T08:45:00Z', '2026-01-29T12:00:00Z')
on conflict (id) do nothing;

-- Task events: include all state changes and assignment history
insert into public.task_events (id, task_id, org_id, actor_id, event_type, old_value, new_value, created_at)
select
  gen_random_uuid(),
  t.id,
  t.org_id,
  '20000000-0000-0000-0000-000000000001'::uuid,
  'task_created',
  null,
  t.title,
  t.created_at
from public.tasks t
where t.id between '50000000-0000-0000-0000-000000000001'::uuid and '50000000-0000-0000-0000-000000000025'::uuid;

insert into public.task_events (id, task_id, org_id, actor_id, event_type, old_value, new_value, created_at)
select
  gen_random_uuid(),
  t.id,
  t.org_id,
  '20000000-0000-0000-0000-000000000002'::uuid,
  'owner_assigned',
  null,
  t.owner_id::text,
  coalesce(t.assigned_at, t.created_at + interval '10 minutes')
from public.tasks t
where t.id between '50000000-0000-0000-0000-000000000001'::uuid and '50000000-0000-0000-0000-000000000025'::uuid;

-- not_started -> in_progress for in_progress, completed, blocked tasks
insert into public.task_events (id, task_id, org_id, actor_id, event_type, old_value, new_value, created_at)
select
  gen_random_uuid(),
  t.id,
  t.org_id,
  t.owner_id,
  'status_changed',
  'not_started',
  'in_progress',
  t.created_at + interval '1 day'
from public.tasks t
where t.id between '50000000-0000-0000-0000-000000000001'::uuid and '50000000-0000-0000-0000-000000000025'::uuid
  and t.status in ('in_progress', 'completed', 'blocked');

-- in_progress -> completed for completed tasks
insert into public.task_events (id, task_id, org_id, actor_id, event_type, old_value, new_value, created_at)
select
  gen_random_uuid(),
  t.id,
  t.org_id,
  t.owner_id,
  'status_changed',
  'in_progress',
  'completed',
  t.created_at + interval '3 days'
from public.tasks t
where t.id between '50000000-0000-0000-0000-000000000001'::uuid and '50000000-0000-0000-0000-000000000025'::uuid
  and t.status = 'completed';

-- in_progress -> blocked for blocked tasks
insert into public.task_events (id, task_id, org_id, actor_id, event_type, old_value, new_value, created_at)
select
  gen_random_uuid(),
  t.id,
  t.org_id,
  t.owner_id,
  'status_changed',
  'in_progress',
  'blocked',
  t.created_at + interval '2 days'
from public.tasks t
where t.id between '50000000-0000-0000-0000-000000000001'::uuid and '50000000-0000-0000-0000-000000000025'::uuid
  and t.status = 'blocked';

commit;
